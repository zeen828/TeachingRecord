[回上層目錄](../README.md)

# 程式語言 / 後端 / Laravel / 使用 / Model / `關係`的教學

## **Description [描述]**
屁話一段

## **Teaching & Examples [教學&範例]**

### `一對一`(One To One)
<details>
<summary>展开查看</summary>

```php
# 關係
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    public function phone()
    {
        // return $this->hasOne(Phone::class);
        // return $this->hasOne(Phone::class, 'user_id');
        return $this->hasOne(Phone::class, 'user_id', 'uid');
    }
}
```

```php
# 反向關係
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Phone extends Model
{
    public function user()
    {
        // return $this->belongsTo(User::class);
        // return $this->belongsTo(User::class, 'user_id');
        return $this->belongsTo(User::class, 'user_id', 'uid');
    }
}
```

```php
# 使用
$phone = User::find(1)->phone;

$user = Phone::find(1)->user;
```

#### 解說
| 表 | 主鍵 | 欄位 |
|---|---|---|
| User | uid | name, status |
| Phone | pid | user_id, phone, status |

`return $this->hasOne(Model::class, 'foreign_key', 'local_key');`
| 欄位 | 說明 | 補充 |
|---|---|---|
| Model::class | 關聯Model | 也可寫成'App/Models/Model' |
| foreign_key | 外鍵 | phone.user_id |
| local_key | 主鍵| user.uid |

`return $this->belongsTo(Model::class, 'foreign_key', 'owner_key');`
| 欄位 | 說明 | 補充 |
|---|---|---|
| Model::class | 關聯Model | 也可寫成'App/Models/Model' |
| foreign_key | 外鍵 | phone.user_id，本身表上紀錄的所有者 |
| owner_key | 所有者 | user.uid，父模組的主鍵 |

</details>

---

#### 關聯防止空配置預設值
```php
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class User extends Model
{
    public function phone()
    {
        // 用陣列表示
        return $this->hasOne(Phone::class, 'user_id', 'uid')
        ->withDefault([
            'name' => 'Guest Author',
        ]);

        // 須引用主體資料可以這樣處理
        return $this->hasOne(Phone::class, 'user_id', 'uid')
        ->withDefault(function ($phone, $user) {
            // 第一個變數是關聯model，第二個變數是主體model
            $phone->phone = '0900000000';
        });
    }
}
```

---

### `一對多`(One To Many)
<details>
<summary>展开查看</summary>

```php
# 關係
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Post extends Model
{
    public function comments()
    {
        // return $this->hasMany(Comment::class);
        // return $this->hasMany(Comment::class, 'post_id');
        return $this->hasMany(Comment::class, 'post_id', 'pid');
    }
}
```

```php
# 反向關係
namespace App\Models;

use Illuminate\Database\Eloquent\Model;

class Comment extends Model
{
    public function post()
    {
        // return $this->belongsTo(Post::class);
        // return $this->belongsTo(User::class, 'post_id');
        return $this->belongsTo(User::class, 'post_id', 'pid');
    }
}
```

```php
# 使用
$comments = Post::find(1)->comments;
foreach ($comments as $comment) {
    //
}
$comment = Post::find(1)->comments()->where('title', 'foo')->first();

$comment = Comment::find(1);
return $title = $comment->post->title;
```

#### 解說
| 表 | 主鍵 | 欄位 |
|---|---|---|
| Post | pid | title, txt, status |
| Comment | cid | post_id, title, txt, status |

`return $this->hasMany(Model::class, 'foreign_key', 'local_key');`
| 欄位 | 說明 | 補充 |
|---|---|---|
| Model::class | 關聯Model | 也可寫成'App/Models/Model' |
| foreign_key | 外鍵 | comment.post_id |
| local_key | 主鍵| post.pid |

`return $this->belongsTo(Model::class, 'foreign_key', 'owner_key');`
| 欄位 | 說明 | 補充 |
|---|---|---|
| Model::class | 關聯Model | 也可寫成'App/Models/Model' |
| foreign_key | 外鍵 | comment.post_id，本身表上紀錄的所有者 |
| owner_key | 所有者 | post.pid，父模組的主鍵 |

</details>

---

### `多對多`
<details>
<summary>展开查看</summary>
</details>

---

## **Reference article [參考文章]**
[參考文件](網址)

## **Author [作者]**
`Mr. Will`
